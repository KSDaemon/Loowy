<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Loowy by KSDaemon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Loowy</h1>
      <h2 class="project-tagline">LUA WAMP client</h2>
      <a href="https://github.com/KSDaemon/Loowy" class="btn">View on GitHub</a>
      <a href="https://github.com/KSDaemon/Loowy/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/KSDaemon/Loowy/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="loowy" class="anchor" href="#loowy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loowy</h1>

<p>LUA WAMP (WebSocket Application Messaging Protocol) client implementation on top of lua-websockets and lib-ev. </p>

<h1>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h1>

<ul>
<li><a href="#description">Description</a></li>
<li><a href="#usage-example">Usage example</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li>
<a href="#loowy-client-instance-methods">Loowy client instance methods</a>

<ul>
<li><a href="#optionsopts">options</a></li>
<li><a href="#getopstatus">getOpStatus</a></li>
<li><a href="#getsessionid">getSessionId</a></li>
<li><a href="#connecturl">connect</a></li>
<li><a href="#disconnect">disconnect</a></li>
<li><a href="#abort">abort</a></li>
<li><a href="#subscribetopicuri-callbacks">subscribe</a></li>
<li><a href="#unsubscribetopicuri-callbacks">unsubscribe</a></li>
<li><a href="#publishtopicuri-payload-callbacks-advancedoptions">publish</a></li>
<li><a href="#calltopicuri-payload-callbacks-advancedoptions">call</a></li>
<li><a href="#registertopicuri-callbacks">register</a></li>
<li><a href="#unregistertopicuri-callbacks">unregister</a></li>
</ul>
</li>
<li><a href="#copyright-and-license">Copyright and License</a></li>
<li><a href="#see-also">See Also</a></li>
</ul>

<h1>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description</h1>

<p>Loowy implements <a href="http://wamp.ws">WAMP</a> v2 client specification.</p>

<p>Loowy supports next WAMP roles and features:</p>

<ul>
<li>publisher: advanced profile with features:

<ul>
<li>subscriber blackwhite listing</li>
<li>publisher exclusion</li>
<li>publisher identification</li>
</ul>
</li>
<li>subscriber: basic profile.</li>
<li>caller: advanced profile with features:

<ul>
<li>callee blackwhite listing.</li>
<li>caller exclusion.</li>
<li>caller identification.</li>
<li>progressive call results.</li>
</ul>
</li>
<li>callee: basic profile.</li>
</ul>

<p>Loowy supports JSON and msgpack serializers.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="usage-example" class="anchor" href="#usage-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage example</h1>

<p>For example usage, please see <a href="tests/test.lua">test.lua</a> file.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>You can install Loowy via luarocks</p>

<div class="highlight highlight-bash"><pre><span class="pl-k">&gt;</span> luarocks install loowy 
</pre></div>

<p>or simply put loowy/client.lua somewhere accessible by lua package.path. 
But in this case you also need to install dependencies.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependencies</h1>

<p>Loowy depends on:</p>

<ul>
<li><a href="https://github.com/lipp/lua-websockets">lua-websockets</a></li>
<li><a href="https://github.com/brimworks/lua-ev">lua-ev</a></li>
<li><a href="https://github.com/harningt/luajson">luajson</a></li>
<li><a href="http://fperrad.github.io/lua-MessagePack/">lua-messagepack</a></li>
</ul>

<p>also it uses <a href="http://olivinelabs.com/busted/">busted</a> for testing.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="loowy-client-instance-methods" class="anchor" href="#loowy-client-instance-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loowy client instance methods</h1>

<h2>
<a id="optionsopts" class="anchor" href="#optionsopts" aria-hidden="true"><span class="octicon octicon-link"></span></a>options([opts])</h2>

<p>options() method can be called in two forms:</p>

<ul>
<li>without parameters it will return table with current options</li>
<li>with one parameter as table it will set new options</li>
</ul>

<p>Options keys description:</p>

<ul>
<li>
<strong>autoReconnect</strong>. Default value: true. Enable autoreconnecting. In case of connection failure, 
Loowy will try to reconnect to WAMP server, and if you were subscribed to any topics,
or had registered some procedures, Loowy will resubscribe to that topics and reregister procedures.</li>
<li>
<strong>reconnectInterval</strong>. Default value: 2(s). Reconnection Interval in seconds.</li>
<li>
<strong>maxRetries</strong>. Default value: 25. Max reconnection attempts. After reaching this value <a href="#disconnect">disconnect()</a>
will be called</li>
<li>
<strong>transportEncoding</strong>. Default value: json. Transport serializer to use. Supported 2 values: json|msgpack.</li>
<li>
<strong>realm</strong>. Default value: nil. WAMP Realm to join on server. See WAMP spec for additional info.</li>
<li>
<strong>onConnect</strong>. Default value: undefined. Callback function. Fired when connection to wamp server is established.</li>
<li>
<strong>onClose</strong>. Default value: undefined. Callback function. Fired on closing connection to wamp server.</li>
<li>
<strong>onError</strong>. Default value: undefined. Callback function. Fired on error in websocket communication.</li>
<li>
<strong>onReconnect</strong>. Default value: undefined. Callback function. Fired every time on reconnection attempt.</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="getopstatus" class="anchor" href="#getopstatus" aria-hidden="true"><span class="octicon octicon-link"></span></a>getOpStatus()</h2>

<p>Get the status of last operation.</p>

<p>returns table: <code>{code, description}</code> where:</p>

<ul>
<li>code: 0 - if operation was successful,</li>
<li>code &gt; 0 - if error occurred,</li>
<li>description contains details about error</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="getsessionid" class="anchor" href="#getsessionid" aria-hidden="true"><span class="octicon octicon-link"></span></a>getSessionId()</h2>

<p>Get the WAMP Session ID.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="connecturl" class="anchor" href="#connecturl" aria-hidden="true"><span class="octicon octicon-link"></span></a>connect([url])</h2>

<p>Connect to server. </p>

<p>Parameters:</p>

<ul>
<li>url - WAMP Server url (optional). Should be specified as URI. For example: ws://my-server/wamp</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="disconnect" class="anchor" href="#disconnect" aria-hidden="true"><span class="octicon octicon-link"></span></a>disconnect()</h2>

<p>Disconnect from server.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="abort" class="anchor" href="#abort" aria-hidden="true"><span class="octicon octicon-link"></span></a>abort()</h2>

<p>Abort WAMP session establishment. Works only if websocket connection is established, 
but WAMP session establishment is in progress.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="subscribetopicuri-callbacks" class="anchor" href="#subscribetopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>subscribe(topicURI, callbacks)</h2>

<p>Subscribe to a topic on a broker.</p>

<p>Parameters:</p>

<ul>
<li>topicURI - topic to subscribe</li>
<li>
<p>callbacks - if it is a function - it will be treated as published event callback 
or it can be hash table of callbacks:</p>

<pre><code>{ onSuccess: will be called when subscribe would be confirmed
  onError: will be called if subscribe would be aborted
  onEvent: will be called on receiving published event }
</code></pre>
</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="unsubscribetopicuri-callbacks" class="anchor" href="#unsubscribetopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>unsubscribe(topicURI, callbacks)</h2>

<p>Unsubscribe from topic.</p>

<p>Parameters:</p>

<ul>
<li>topicURI - topic to unsubscribe</li>
<li>
<p>callbacks - if it is a function - it will be treated as published event callback to remove or it can be hash table of callbacks:</p>

<pre><code>{ onSuccess: will be called when unsubscribe would be confirmed
  onError: will be called if unsubscribe would be aborted
  onEvent: published event callback to remove }
</code></pre>
</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="publishtopicuri-payload-callbacks-advancedoptions" class="anchor" href="#publishtopicuri-payload-callbacks-advancedoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>publish(topicURI, payload, callbacks, advancedOptions)</h2>

<p>Publish a event to topic.</p>

<p>Parameters:</p>

<ul>
<li>topicURI - topic to publish</li>
<li>payload - optional parameter, can be any value</li>
<li>
<p>callbacks - optional table of callbacks:</p>

<pre><code>{ onSuccess: will be called when publishing would be confirmed 
  onError: will be called if publishing would be aborted }
</code></pre>
</li>
<li>
<p>advancedOptions - optional parameter. Must include any or all of the options:</p>

<pre><code>{ exclude: integer|array WAMP session id(s) that won't receive a published
           event, even though they may be subscribed
  eligible: integer|array WAMP session id(s) that are allowed 
           to receive a published event
  exclude_me: bool flag of receiving publishing event by initiator
  disclose_me: bool flag of disclosure of publisher identity 
           (its WAMP session ID) to receivers of a published event }
</code></pre>
</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="calltopicuri-payload-callbacks-advancedoptions" class="anchor" href="#calltopicuri-payload-callbacks-advancedoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>call(topicURI, payload, callbacks, advancedOptions)</h2>

<p>Remote Procedure Call.</p>

<p>Parameters:</p>

<ul>
<li>topicURI - topic to call</li>
<li>payload - can be either a value of any type or null</li>
<li>
<p>callbacks - if it is a function - it will be treated as result callback function or it can be hash table of callbacks:</p>

<pre><code>{ onSuccess: will be called with result on successful call
  onError: will be called if invocation would be aborted }
</code></pre>
</li>
<li>
<p>advancedOptions - optional parameter. Must include any or all of the options:</p>

<pre><code>{ exclude: integer|array WAMP session id(s) providing an explicit list of
           (potential) Callees that a call won't be forwarded to, 
           even though they might be registered
  eligible: integer|array WAMP session id(s) providing an explicit list of
           (potential) Callees that are (potentially) forwarded the call issued
  exclude_me: bool flag of potentially forwarding call to caller 
           if he is registered as callee
  disclose_me: bool flag of disclosure of Caller identity 
           (WAMP session ID) to endpoints of a routed call }
</code></pre>
</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="registertopicuri-callbacks" class="anchor" href="#registertopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>register(topicURI, callbacks)</h2>

<p>RPC registration for invocation.</p>

<p>Parameters:</p>

<ul>
<li>topicURI - topic to register</li>
<li>
<p>callbacks - if it is a function - it will be treated as rpc itself or it can be hash table of callbacks:</p>

<pre><code>{ rpc: registered procedure
  onSuccess: will be called on successful registration
  onError: will be called if registration would be aborted }
</code></pre>
</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h2>
<a id="unregistertopicuri-callbacks" class="anchor" href="#unregistertopicuri-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>unregister(topicURI, callbacks)</h2>

<p>RPC unregistration for invocation.</p>

<p>Parameters:</p>

<ul>
<li>topicURI - topic to unregister</li>
<li>
<p>callbacks - if it is a function, it will be called on successful unregistration or it can be hash table of callbacks:</p>

<pre><code>{ onSuccess: will be called on successful unregistration
  onError: will be called if unregistration would be aborted }
</code></pre>
</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="copyright-and-license" class="anchor" href="#copyright-and-license" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright and License</h1>

<p>Loowy is licensed under the MIT license.</p>

<p>Copyright (c) 2014, Konstantin Burkalev</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p>

<p><a href="#table-of-contents">Back to TOC</a></p>

<h1>
<a id="see-also" class="anchor" href="#see-also" aria-hidden="true"><span class="octicon octicon-link"></span></a>See Also</h1>

<ul>
<li><a href="http://wamp.ws">WAMP specification</a></li>
<li>
<a href="https://github.com/KSDaemon/wampy.js">Wampy.js</a>. WAMP Javascript client-side implementation.</li>
<li>
<a href="https://github.com/KSDaemon/wiola">Wiola</a>. WAMP router powered by LUA Nginx module, Lua WebSocket addon, and Redis as cache store.</li>
</ul>

<p><a href="#table-of-contents">Back to TOC</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/KSDaemon/Loowy">Loowy</a> is maintained by <a href="https://github.com/KSDaemon">KSDaemon</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

